# FreeMyMusicPlayer 仕様書

## 概要
FreeMyMusicPlayerは、Android端末でローカルの音楽ファイルを再生するためのシンプルな音楽プレイヤーアプリです。

## アプリケーション基本情報
- **アプリ名**: FreeMyMusicPlayer
- **パッケージ名**: com.enzo.freemymusicplayer
- **対象プラットフォーム**: Android
- **開発言語**: Kotlin
- **アーキテクチャ**: MVVM + Repository パターン

## 機能仕様

### 1. 音楽ファイル管理機能
#### 1.1 音楽ファイルスキャン
- 端末内の音楽ファイルを自動スキャン
- 対応フォーマット: MP3, MP4, AAC, OGG, FLAC等（Media3 ExoPlayerが対応するフォーマット）
- メタデータ取得（タイトル、アーティスト、アルバム、再生時間、アルバムアート）

#### 1.2 楽曲情報表示
- 楽曲リスト表示（RecyclerView）
- 楽曲情報の表示項目:
  - タイトル
  - アーティスト名
  - アルバム名
  - 再生時間（mm:ss形式）
  - アルバムアート（利用可能な場合）

### 2. 音楽再生機能
#### 2.1 基本再生操作
- 再生/一時停止
- 前の曲/次の曲
- シークバーによる再生位置操作
- バックグラウンド再生対応

#### 2.2 シャッフル再生機能
- フォルダ内楽曲のランダム再生
- 同じ曲の連続再生防止
- 再生履歴管理による重複防止
- 内部プレイリストの動的シャッフル

#### 2.3 リピート再生機能
- **オフ**: フォルダ内全曲再生後停止
- **単体リピート**: 現在の曲を繰り返し再生
- **全体リピート**: フォルダ内全曲を繰り返し再生

#### 2.4 再生制御
- Media3 ExoPlayerを使用した高品質再生
- オーディオフォーカス管理
- ヘッドフォン取り外し時の自動一時停止
- MediaSessionService による統合制御

### 3. ユーザーインターフェース
#### 3.1 メイン画面
- 楽曲リスト表示エリア
- 再生制御パネル（画面下部固定）
- 読み込み状態表示

#### 3.2 再生制御パネル
- 現在再生中の楽曲情報表示
- 再生/一時停止ボタン
- 前の曲/次の曲ボタン
- シャッフル切り替えボタン
- リピートモード切り替えボタン
- 再生進捗シークバー

## 技術仕様

### アーキテクチャ構成
```
app/
├── MainActivity.kt                 # メインアクティビティ
├── adapter/
│   └── SongAdapter.kt             # 楽曲リスト表示用アダプター
├── controller/
│   └── MusicPlayerController.kt   # 音楽再生制御
├── model/
│   ├── Song.kt                    # 楽曲データモデル
│   └── PlaybackState.kt          # 再生状態管理
├── service/
│   ├── MusicPlayerService.kt      # バックグラウンド再生サービス
│   └── MusicScanner.kt           # 音楽ファイルスキャン
└── ui/
    ├── dashboard/                 # ダッシュボード画面
    ├── home/                      # ホーム画面
    └── notifications/             # 通知画面
```

### 使用ライブラリ・フレームワーク
- **Media3**: 音楽再生エンジン
- **ExoPlayer**: 高性能メディアプレイヤー
- **MediaSession**: メディア制御統合
- **RecyclerView**: 楽曲リスト表示
- **ConstraintLayout**: レイアウト管理

### データモデル
#### Song クラス
```kotlin
data class Song(
    val id: Long,           // 楽曲ID
    val title: String,      // タイトル
    val artist: String,     // アーティスト名
    val album: String,      // アルバム名
    val duration: Long,     // 再生時間（ミリ秒）
    val data: String,       // ファイルパス
    val uri: Uri,          // ファイルURI
    val albumId: Long,      // アルバムID
    var albumArt: Bitmap?   // アルバムアート
)
```

## 権限要件
- `READ_EXTERNAL_STORAGE`: 音楽ファイルアクセス用
- `READ_MEDIA_AUDIO`: Android 13以降のメディアアクセス用
- `FOREGROUND_SERVICE`: バックグラウンド再生用
- `WAKE_LOCK`: 再生中のスリープ防止用

## パフォーマンス要件
- アプリ起動時間: 3秒以内
- 楽曲リスト表示: 1000曲以下で滑らかなスクロール
- バックグラウンド再生: メモリ使用量50MB以下
- バッテリー効率: 1時間再生でバッテリー消費5%以下

## 今後の拡張予定
- プレイリスト機能
- イコライザー機能
- 楽曲検索機能
- テーマ・UI カスタマイズ
- クロスフェード機能

## 動作確認環境
- 実機でのテスト実施
- Android 8.0 (API 26) 以上対応
- 各種画面サイズ対応（スマートフォン・タブレット）

## セキュリティ考慮事項
- ローカルファイルのみアクセス（外部通信なし）
- 適切な権限管理
- ユーザーデータの外部送信なし